# üìò –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –æ–Ω–ª–∞–π–Ω-–æ–±—É—á–µ–Ω–∏—è

## üèóÔ∏è –û–±—â–∏–π –æ–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ.  
–í—Å–µ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ **API Gateway**, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é, –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –∑–∞—â–∏—Ç—É (rate limiting, CORS, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ).

–ö–∞–∂–¥—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –æ—Ç–≤–µ—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∑–∞ —Å–≤–æ–π –±–∏–∑–Ω–µ—Å-–¥–æ–º–µ–Ω –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ —á–µ—Ä–µ–∑ HTTP (REST) –ø–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–µ—Ç–∏.

---

## üåê –í–∏–∑—É–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

```mermaid
graph TD
    subgraph CLIENT
        A[Frontend (React / Vue / Angular)]
    end

    subgraph GATEWAY
        B[API Gateway<br/>Spring Cloud Gateway<br/>:8080]
    end

    subgraph SERVICES
        U[User Service<br/>:8081<br/>PostgreSQL (users_db)]
        C[Course Service<br/>:8082<br/>PostgreSQL (courses_db)]
        E[Enrollment Service<br/>:8083<br/>PostgreSQL (enrollments_db)]
        P[Payment Service<br/>:8084<br/>PostgreSQL (payments_db)]
        N[Notification Service<br/>:8085<br/>PostgreSQL (notifications_db)]
        A2[Analytics Service<br/>:8086<br/>PostgreSQL (analytics_db)]
    end

    A -->|"HTTP + JWT Token"| B
    B -->|"–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è + –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞"| U
    B --> C
    B --> E
    B --> P
    B --> N
    B --> A2

    U -->|"–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è / –õ–æ–≥–∏–Ω / JWT –≤—ã–¥–∞—á–∞"| B
```

---

## üö™ API Gateway (–ø–æ—Ä—Ç 8080)

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è:** Spring Cloud Gateway  
**–†–æ–ª—å:** –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –≤—Å–µ—Ö –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- ‚úÖ **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ JWT: –ø–æ–¥–ø–∏—Å—å, `exp`, `iss`, `aud`.
- ‚úÖ **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (coarse-grained)** ‚Äî —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤ –ø–æ —Ä–æ–ª—è–º.
- ‚öôÔ∏è **Rate Limiting** ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤.
- üåç **CORS** ‚Äî —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞.
- üßæ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞** (`X-Request-Id`, `Trace-Id`).
- üîí **–°—Ç—Ä–∏–ø–ø–∏–Ω–≥ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤** ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö `X-User-*`, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö.
- üö´ **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞** –∫ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º (–¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∏–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–µ—Ç–∏).

### üîê JWT-–ø–æ—Ç–æ–∫

1. –ö–ª–∏–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç `POST /api/users/login` (—á–µ—Ä–µ–∑ Gateway).
2. Gateway –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ `User Service`.
3. `User Service` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –∏ **–≤—ã–¥–∞—ë—Ç JWT**.
4. –í—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –∫–ª–∏–µ–Ω—Ç –¥–µ–ª–∞–µ—Ç —Å `Authorization: Bearer <JWT>`.
5. Gateway –ø—Ä–æ–≤–µ—Ä—è–µ—Ç JWT –∏ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –¥–∞–ª—å—à–µ –≤ –Ω—É–∂–Ω—ã–π —Å–µ—Ä–≤–∏—Å.

---

## üë§ User Service (–ø–æ—Ä—Ç 8081)

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**  
–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ —Ä–æ–ª—è–º–∏, –≤—ã–ø—É—Å–∫ JWT.

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** PostgreSQL (`users_db`)

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- `UserService` ‚Äî CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏, –ø—Ä–æ—Ñ–∏–ª–∏, —Ä–æ–ª–∏.
- `AuthService` ‚Äî –ª–æ–≥–∏–Ω, refresh, logout, –≤—ã–¥–∞—á–∞ —Ç–æ–∫–µ–Ω–æ–≤.
- `JwtProvider` ‚Äî –ø–æ–¥–ø–∏—Å—å –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è JWT, —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª—é—á–µ–π.
- `RoleService` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏ –∏ –ø—Ä–∞–≤–∞–º–∏ (RBAC).

### –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:
| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|-----------|-----------|
| POST | `/api/users/register` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| POST | `/api/users/login` | –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –≤—ã–¥–∞—á–∞ JWT |
| POST | `/api/users/refresh` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ |
| GET | `/api/users/profile` | –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª—è |
| PUT | `/api/users/profile` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è |
| GET | `/api/users/{id}` | –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ |

---

## üéì Course Service (–ø–æ—Ä—Ç 8082)

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**  
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–∞–º–∏, —É—Ä–æ–∫–∞–º–∏ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏.

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** PostgreSQL (`courses_db`)

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
- `GET /api/courses` ‚Äî —Å–ø–∏—Å–æ–∫ –∫—É—Ä—Å–æ–≤ (–ø—É–±–ª–∏—á–Ω–æ)
- `POST /api/courses` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∫—É—Ä—Å–∞ (`teacher` –∏–ª–∏ `admin`)
- `GET /api/courses/{id}` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫—É—Ä—Å–µ
- `PUT /api/courses/{id}` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–∞
- `DELETE /api/courses/{id}` ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –∫—É—Ä—Å–∞
- `GET /api/courses/{id}/lessons` ‚Äî —Å–ø–∏—Å–æ–∫ —É—Ä–æ–∫–æ–≤

---

## üßæ Enrollment Service (–ø–æ—Ä—Ç 8083)

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**  
–ó–∞–ø–∏—Å—å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –Ω–∞ –∫—É—Ä—Å—ã, –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—É—á–µ–Ω–∏—è.

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** PostgreSQL (`enrollments_db`)

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
- `POST /api/enrollments` ‚Äî –∑–∞–ø–∏—Å–∞—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞
- `GET /api/enrollments/user/{userId}` ‚Äî –≤—Å–µ –∑–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GET /api/enrollments/course/{courseId}` ‚Äî –≤—Å–µ —Å—Ç—É–¥–µ–Ω—Ç—ã –∫—É—Ä—Å–∞
- `PUT /api/enrollments/{id}/progress` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å

---

## üí≥ Payment Service (–ø–æ—Ä—Ç 8084)

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**  
–ü–ª–∞—Ç–µ–∂–∏, –∏—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, –≤–æ–∑–≤—Ä–∞—Ç—ã.

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** PostgreSQL (`payments_db`)

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
- `POST /api/payments/process`
- `GET /api/payments/user/{userId}`
- `GET /api/payments/{id}`
- `POST /api/payments/refund`

---

## üîî Notification Service (–ø–æ—Ä—Ç 8085)

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**  
–û—Ç–ø—Ä–∞–≤–∫–∞ email, push –∏ SMS —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** PostgreSQL (`notifications_db`)

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
- `POST /api/notifications/send`
- `GET /api/notifications/user/{userId}`
- `PUT /api/notifications/{id}/read`

---

## üìä Analytics Service (–ø–æ—Ä—Ç 8086)

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**  
–°–±–æ—Ä –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º, –∫—É—Ä—Å–∞–º, –≤—ã—Ä—É—á–∫–µ –∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** PostgreSQL (`analytics_db`)

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
- `GET /api/analytics/users/stats`
- `GET /api/analytics/courses/stats`
- `GET /api/analytics/revenue`
- `GET /api/analytics/dashboard`

---

## üîÑ –ü–æ—Ç–æ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∑–∞–ø—Ä–æ—Å–æ–≤

```mermaid
sequenceDiagram
    participant F as Frontend
    participant G as API Gateway
    participant U as User Service
    participant C as Course Service

    F->>G: POST /api/users/login (email, password)
    G->>U: –ü—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å
    U-->>G: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT
    G-->>F: JWT Token

    F->>G: GET /api/courses (Authorization: Bearer JWT)
    G->>G: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –∏ —Ä–æ–ª–µ–π
    G->>C: –ü—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å (–ø–µ—Ä–µ–¥–∞—ë—Ç —Ç–æ–∫–µ–Ω)
    C-->>G: –î–∞–Ω–Ω—ã–µ –∫—É—Ä—Å–æ–≤
    G-->>F: –û—Ç–≤–µ—Ç
```

---

## üß† –ü—Ä–∏–Ω—Ü–∏–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

- –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã **—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ API Gateway**.  
- Gateway –ø—Ä–æ–≤–µ—Ä—è–µ—Ç JWT, —Å–µ—Ä–≤–∏—Å—ã ‚Äî —Ç–æ–ª—å–∫–æ –ø—Ä–∞–≤–∞ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã.  
- mTLS –∏–ª–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Ç—å –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤.  
- –ö–æ—Ä–æ—Ç–∫–æ–∂–∏–≤—É—â–∏–µ JWT (5‚Äì15 –º–∏–Ω) + refresh-—Ç–æ–∫–µ–Ω—ã.  
- –°–µ–∫—Ä–µ—Ç—ã –∏ –∫–ª—é—á–∏ JWT ‚Äî —Ç–æ–ª—å–∫–æ –≤ `user-service`.  
- –í—Å–µ `X-User-*` –∑–∞–≥–æ–ª–æ–≤–∫–∏ –æ–±–Ω—É–ª—è—é—Ç—Å—è –Ω–∞ –≤—Ö–æ–¥–µ –≤ Gateway.  
- Rate limiting –¥–ª—è `/login`, `/refresh`, `/payments/process`.  

---

## üß© –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–æ–≤

| –°–µ—Ä–≤–∏—Å | –ü–æ—Ä—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------|------|------------|
| **API Gateway** | 8080 | –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è, JWT –ø—Ä–æ–≤–µ—Ä–∫–∞, rate limiting |
| **User Service** | 8081 | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ª–æ–≥–∏–Ω, –ø—Ä–æ—Ñ–∏–ª–∏, —Ç–æ–∫–µ–Ω—ã |
| **Course Service** | 8082 | –ö—É—Ä—Å—ã –∏ —É—Ä–æ–∫–∏ |
| **Enrollment Service** | 8083 | –ó–∞–ø–∏—Å–∏ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å |
| **Payment Service** | 8084 | –ü–ª–∞—Ç–µ–∂–∏ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ |
| **Notification Service** | 8085 | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è |
| **Analytics Service** | 8086 | –û—Ç—á—ë—Ç—ã –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ |
